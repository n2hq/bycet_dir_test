import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as s}from"./components-CqyJs_9b.js";import{u as Y}from"./SliderContext-cbUj0vkw.js";import{B as Z}from"./lib-C4HmGJL5.js";import{u as $}from"./AuthContext-CWrmJizj.js";import{u as ee,a as te}from"./zod-DwrW5z8F.js";import{u as se}from"./NotificationContext-BLePBlJ_.js";import{u as ne}from"./OperationContext-BdFCpeXF.js";import{o as oe,a as C}from"./types-DBTFAyTi.js";const P=s.createContext(null);function je(){return s.useContext(P)}const ye=({children:h})=>{const[a,c]=s.useState(!1),[l,E]=s.useState(null),f=Y(),[d,k]=s.useState(null),v="https://tpics.gasimg.com",g=()=>c(!1);let b={setShow:c,setGallery:E,setListing:k};const j=o=>{f.setDialog(!0),f.setSelectedSlide(o+1),f.setGallery(l)};return s.useEffect(()=>{const o=r=>{r.key==="Escape"&&g()};return a&&document.addEventListener("keydown",o),()=>{document.removeEventListener("keydown",o)}},[a]),s.useEffect(()=>{l&&console.log(l)},[l]),e.jsxs(P.Provider,{value:b,children:[a&&e.jsxs("div",{onMouseDown:o=>c(!1),className:`flex w-screen h-screen bg-black/80 
                        z-[20000] fixed top-0 left-0 right-0 bottom-0
                        place-items-center place-content-center px-[15px]`,children:[e.jsx("div",{onMouseDown:o=>o.stopPropagation(),className:`w-[95%] sm:w-[85%] md:w-[75%] lg:w-[70%] xl:w-[60%] h-[70%] 
                            mx-auto bg-white rounded-lg shadow-lg border
                            space-y-6 z-[3100] overflow-hidden`,children:e.jsxs("div",{className:"w-full h-full",children:[e.jsx("div",{className:"border-b py-3 px-3",children:e.jsxs("div",{className:`font-bold text-gray-700
                                    text-xl w-[80%]  truncate`,children:["Gallery for ",d&&(d==null?void 0:d.title)]})}),e.jsxs("div",{className:` 
                                h-[90%] overflow-y-auto pt-2 px-2 pb-2
                                bg-white `,children:[e.jsx("div",{className:"grid grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-2 h-auto",children:l&&(l==null?void 0:l.map((o,r)=>e.jsxs("div",{children:[e.jsx("div",{onClick:()=>j(r),className:`relative hover:cursor-pointer
                                                 bg-red-200 h-[80px] md:h-[100px] lg:h-[120px] rounded-md
                                                 overflow-hidden`,children:e.jsx("img",{className:"object-cover w-full h-full",src:v+o.image_url,alt:""})}),e.jsx("div",{className:"line-clamp-2 leading-[1.2em] text-sm mt-2",children:o==null?void 0:o.image_title})]},r)))}),e.jsx("div",{className:"h-4"})]})]})}),e.jsx("div",{onMouseDown:()=>g(),className:`w-[30px] h-[30px] z-[300] bg-white
                                flex place-content-center place-items-center
                                rounded-full absolute left-2 top-2 cursor-pointer
                                hover:bg-white/40 transition duration-1000 ease-in-out`,children:e.jsx(Z,{className:"text-[30px]"})})]}),h]})},w=100,T=s.createContext(null);function Ne(){return s.useContext(T)}const le=oe({fullname:C(),rating:C(),comment:C()});function Se({children:h}){var L,G,_;const[a,c]=s.useState(!1),[l,E]=s.useState(!1),[f,d]=s.useState(null),[k,v]=s.useState(void 0),[g,b]=s.useState("");se();const{showOperation:j,showError:o,completeOperation:r,showSuccess:K}=ne(),[ae,M]=s.useState(5),D=$();if(!D)return null;let{user:O}=D;const[re,z]=s.useState(null),[A,p]=s.useState(!1),R=t=>t.trim()===""?0:t.trim().split(/\s+/).length,y=t=>{let n=t.target.value,i=t.target.name;z(u=>({...u,[i]:n}))},{register:N,handleSubmit:U,getValues:ie,setValue:S,watch:F,reset:V,setError:ce,formState:{errors:m,isSubmitting:de}}=ee({resolver:te(le)}),I=t=>{const n=t.target.value,i=n.trim().split(/\s+/);if(i.length<=w)S("text",n),p(!1);else{p(!0);const u=i.slice(0,w).join(" ");S("text",u)}},H=async t=>{j("processing"),await new Promise(x=>setTimeout(x,1e3));const n=O.guid,i=f.gid;t.user_guid=n,t.business_guid=i;const X="https://test.bycet.com"+"/api/rating";try{const x=await fetch(X,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),B=await x.json();x.ok?(K("Success","Rating submitted."),r()):(console.log(B.error),o("Error",B.error),r())}catch(x){o("Error","Rating not submitted."),r(),console.log(x.message)}};let J={show:a,setShow:c,setListing:d,reset:V,setRatingData:v,validateData:async(t,n)=>{if((t==null?void 0:t.length)===0){let i=(n==null?void 0:n.first_name)||"",u=(n==null?void 0:n.last_name)||"",W=i+" "+u;S("fullname",W)}}};const q=F("text")||"",Q=t=>{q.trim().split(/\s+/).length>=w&&t.key!=="Backspace"&&t.key!=="Delete"&&!t.ctrlKey?(t.preventDefault(),p(!0)):p(!1)};return s.useEffect(()=>{const t=n=>{n.key==="Escape"&&c(!1)};return a&&document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[a]),e.jsxs(T.Provider,{value:J,children:[a&&e.jsx("div",{className:`flex w-full h-full bg-black/40 z-[3000] 
                fixed top-0 left-0 right-0 bottom-0 place-items-center place-content-center`,children:e.jsx("div",{className:"max-w-[400px] w-full h-fit mx-auto bg-white rounded-xl shadow-md ",children:e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Create/Edit Rating"}),e.jsxs("form",{onSubmit:U(H),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-semibold",children:"Full Name"}),e.jsx("input",{...N("fullname",{onChange:y}),type:"text",className:`w-full px-3 py-2 border rounded-md
                                        text-sm`,placeholder:"Enter Business GUID"}),((L=m.fullname)==null?void 0:L.message)&&e.jsx("div",{className:"text-red-500 mt-1 text-sm",children:m.fullname.message.toString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-semibold",children:"Stars"}),e.jsx("select",{...N("rating",{onChange:t=>{M(Number(t.target.value)),y(t)}}),className:`w-full px-3 py-2 border rounded-md
                                        text-sm`,children:[5,4,3,2,1].map(t=>e.jsxs("option",{value:t,children:[t," Star",t>1?"s":""]},t))}),((G=m.rating)==null?void 0:G.message)&&e.jsx("div",{className:"text-red-500 mt-1 text-sm",children:m.rating.message.toString()})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex place-content-between",children:[e.jsx("label",{className:"block mb-1 text-sm font-semibold",children:"Comment"}),e.jsxs("label",{className:" text-gray-600 text-sm",children:["Word Count: ",e.jsx("strong",{children:R(g)})]})]}),e.jsx("textarea",{...N("comment",{onChange:t=>{R(g)<=w?(b(t.target.value),I(t),y(t)):t.preventDefault()}}),onKeyDown:Q,className:`w-full px-3 py-2 border rounded-md 
                                        text-sm`,placeholder:"Write your review...",rows:4}),A&&e.jsx("div",{className:"text-red-500 mt-0 text-sm",children:"Maximum maximumWords words allowed."}),((_=m.comment)==null?void 0:_.message)&&e.jsx("div",{className:"text-red-500 mt-0 text-sm",children:m.comment.message.toString()})]}),e.jsxs("div",{className:"w-full grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>c(!1),className:`w-full bg-red-200 rounded-md
                                        hover:bg-red-100 text-sm`,children:"Close"}),e.jsx("button",{type:"submit",disabled:l,className:`w-full bg-[#D71616] text-white py-2 outline-none
                                        rounded-md hover:bg-[#D71616]/80 text-sm`,children:l?"Submitting...":"Submit Rating"})]})]})]})})}),h]})}export{ye as G,Se as R,Ne as a,je as u};
