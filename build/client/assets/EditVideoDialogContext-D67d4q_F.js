import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as t}from"./components-CqyJs_9b.js";import{u as de}from"./NotificationContext-BLePBlJ_.js";import{Q as ae,U as me,x as pe,u as xe,V as fe,f as ve}from"./lib-C4HmGJL5.js";import{u as ne}from"./OperationContext-BdFCpeXF.js";import{o as he,s as O}from"./types-DBTFAyTi.js";const re=t.createContext(null);function Ne(){return t.useContext(re)}const ge=/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[\W_]).{8,}$/;he({videolink:O({message:"Please enter the video link"}),url:O().url("Video link is not valid."),videotitle:O({message:"Please enter a password"}).min(8,"Password must be at least 8 characters").regex(ge,"Please enter a valid password"),videodescription:O().trim().max(500,"Description must be less than 500 characters.").optional()});function Ie({children:l}){const[se,s]=t.useState(!1),[w,y]=t.useState(!1),[f,D]=t.useState(null),[U,Y]=t.useState(null),[P,F]=t.useState(null),[W,K]=t.useState(!1),[R,M]=t.useState(null),V=de(),[v,$]=t.useState(null),[le,L]=t.useState(null),[G,T]=t.useState(!1),[J,_]=t.useState(!1),[S,Q]=t.useState(void 0),[A,N]=t.useState(""),{showOperation:j,showError:E,completeOperation:h,showSuccess:Z}=ne();t.useEffect(()=>{w&&(T(!1),_(!1),Q(void 0),N(""))},[w]),t.useEffect(()=>{A&&A.trim().length>0?(T(!1),_(!0)):(T(!1),_(!1))},[A]);const q=()=>{y(!1),D(null)};t.useEffect(()=>{const o=document.getElementById("videolink");Q(o)},[]),t.useEffect(()=>{(S==null?void 0:S.value.trim().length)>0&&_(!0)},[S]);const z=()=>{j("processing","Verifying video link.");const o=document.getElementById("videolink");X(o.value)};async function H(o){const p=`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${o}&format=json`;try{const d=await fetch(p);if(!d.ok)throw new Error("Video not found");const x=await d.json();return!0}catch{return console.error("❌ Invalid or unavailable video"),!1}}const X=async o=>{j("processing"),await new Promise(a=>setTimeout(a,1e3));const p=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/,d=o.match(p);let x=d?d[1]:null,I=`https://img.youtube.com/vi/${x}/0.jpg`,n={videoId:x,videoUrl:o,videoThumbnail:I};if(await H(x))try{$(n),T(!0);const a=document.getElementById("yt-iframe");a.src=`https://www.youtube.com/embed/${n==null?void 0:n.videoId}`}finally{h(),Z("Verified","Enter the video title and optional description to continue.")}else E("Video Error","Video could not be loaded."),h();await new Promise(a=>setTimeout(a,1e3)),$(n)};t.useEffect(()=>{const o=document.getElementById("yt-iframe");o!=null&&o.onload&&console.log("✅ Iframe page loaded"),L(o)},[]);const ee=o=>{N(o)},B=async()=>{s(!0),j("processing","Submitting video link"),await new Promise(oe=>setTimeout(oe,1e3));let o=document.getElementById("videolink"),p=document.getElementById("videotitle"),d=document.getElementById("videodescr"),x=o.value,I=p.value,n=d.value;if(x.trim().length<=0)return E("Error","Please enter a Youtube video link"),h(),s(!1),!1;if(I.trim().length<=0)return E("Error","Please enter a video title"),h(),s(!1),!1;if(n.trim().length>500)return V.alertCancel("Submission error!","Video description should not be more than 500 characters!"),s(!1),!1;const a=await me({video_url:x,video_title:I,video_description:n,user_guid:U,business_guid:P,video_guid:""});if(a!=null&&a.data.videoInsertId)try{Z("Success","Video link submitted"),h()}finally{window.location.reload()}else V==null||V.alertCancel("Submission Error","Video Link submission failed."),E("Error","Submission failed."),h()};let m={dialog:w,setDialog:y,imgSrc:f,setImgSrc:D,handleCloseDialog:q,userGuid:U,setUserGuid:Y,businessGuid:P,setBusinessGuid:F,isImgSelected:W,setIsImageSelected:K,selectedFile:R,setSelectedFile:M};return e.jsxs(re.Provider,{value:m,children:[w&&e.jsx("div",{className:`flex w-screen h-screen z-[3000] 
                fixed top-0 left-0 right-0 bottom-0 bg-black/30 rounded-[8px]
                place-content-center place-items-center overflow-hidden`,children:e.jsxs("div",{className:`relative max-w-[600px] w-full h-fit bg-white mx-2
                        rounded-[40px] overflow-x-hidden overflow-y-hidden z-[3000]`,onClick:o=>{o.preventDefault()},children:[e.jsx(be,{setShow:y}),e.jsx("div",{className:"pt-12 pb-2 px-3 text-2xl font-semibold",children:"Add Video"}),e.jsxs("div",{className:"flex mb-3 flex-col mx-3 ",children:[e.jsx("div",{className:"text-[15px] pt-1 pb-1",children:"Paste a Youtube video link"}),e.jsxs("div",{className:"flex place-content-between place-items-center gap-x-4",children:[e.jsx("div",{className:"grow",children:e.jsx("input",{id:"videolink",type:"text",placeholder:"Paste a Youtube Video",className:"w-full border-[1px] border-gray-300 bg-gray-100 px-3 py-2 outline-none rounded-lg text-xl",onKeyUp:o=>{ee(o.target.value)}})}),e.jsx("div",{children:e.jsx("button",{onClick:()=>z(),disabled:!J,className:`${J?"bg-blue-800":"bg-blue-300"} ${G&&"hidden"} text-white px-3 py-2.5 rounded-md
                                    shadow-md `,children:"Verify"})})]})]}),e.jsxs("div",{className:"relative w-full h-[300px] overflow-y-auto",children:[e.jsx("div",{className:"relative w-full h-full bg-black",children:e.jsxs("div",{className:" relative w-full h-full text-white flex place-items-center place-content-center flex-col",children:[se?"Loading...":"Waiting...",e.jsx("iframe",{id:"yt-iframe",src:v!=null&&v.videoId?`https://www.youtube.com/embed/${v==null?void 0:v.videoId}`:void 0,className:"absolute top-0 left-0 w-full h-full bg-transparent",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"})]})}),e.jsxs("div",{className:"flex mb-1 flex-col mx-3 ",children:[e.jsx("div",{className:"text-[15px] pt-3 pb-1",children:"Enter video title"}),e.jsx("input",{id:"videotitle",type:"text",placeholder:"Enter Video Title",className:"w-full border-[1px] border-gray-300 bg-gray-100 px-3 py-4 outline-none rounded-lg text-xl"})]}),e.jsxs("div",{className:"flex mb-1 flex-col mx-3 ",children:[e.jsx("div",{className:"text-[15px] pt-3 pb-1",children:"Enter title description"}),e.jsx("textarea",{id:"videodescr",placeholder:"Enter picture description.",className:"w-full border-[1px] border-gray-300 bg-gray-100 px-3 py-4 outline-none rounded-lg text-xl"})]}),e.jsxs("div",{className:"flex place-content-end px-6 gap-2 py-6",children:[e.jsx("button",{onMouseDown:()=>q(),className:`bg-gray-800 text-white px-3 py-1.5 rounded-md
                                    shadow-md `,children:"Cancel"}),e.jsx("button",{onClick:()=>B(),className:`bg-blue-800 text-white px-3 py-1.5 rounded-md
                                    shadow-md  ${G?"block":"hidden"}`,children:"Submit"})]})]})]})}),l]})}const be=({setShow:l})=>e.jsx("div",{className:"absolute top-8 right-6 text-3xl  rounded-xl  w-[40px] h-[40px] shadow-sm flex place-items-center place-content-center cursor-pointer bg-gray-200/70 hover:border-gray-200/50 text-gray-400 hover:text-gray-500 z-10",onClick:()=>l(!1),children:e.jsx(ae,{})}),ce=t.createContext(null);function Ce(){const l=t.useContext(ce);if(!l)throw new Error("Wrap the app with an EditVideoDialogProvider!");return l}function De({children:l}){const[se,s]=t.useState(!1),[w,y]=t.useState(!1),[f,D]=t.useState(null),[U,Y]=t.useState(null),[P,F]=t.useState(null),[W,K]=t.useState(!1),[R,M]=t.useState(null),[V,v]=t.useState(null),[$,le]=t.useState(null),[L,G]=t.useState(null),[T,J]=t.useState(null),[_,S]=t.useState(null),[Q,A]=t.useState(null),[N,j]=t.useState(!1),[E,h]=t.useState(!0),[Z,q]=t.useState(void 0),[z,H]=t.useState(""),[X,ee]=t.useState(null);t.useRef(null),de();const{showOperation:B,showError:m,completeOperation:o,showSuccess:p}=ne();t.useEffect(()=>{z.trim().length>0&&(j(!1),h(!0))},[z]),t.useEffect(()=>{if(f){const i=pe(f);ee(i)}},[f]);const d=()=>{y(!1),D(null),s(!1)},x=async()=>{s(!0),B("processing"),await new Promise(ie=>setTimeout(ie,1e3));let i=document.getElementById("videolink"),k=document.getElementById("videotitle"),r=document.getElementById("videodescr"),g=i.value,C=k.value,c=r.value;if(g.trim().length<=0)return m("Error","Please enter a video link to proceed."),o(),s(!1),!1;if(C.trim().length<=0)return m("Error","Please enter a title for the video."),o(),s(!1),!1;if(c.trim().length>500)return m("Error","Video description should not be more than 500 characters."),o(),s(!1),!1;const u=await fe({video_url:g,video_title:C,video_description:c,user_guid:U,business_guid:P,video_guid:L});(u==null?void 0:u.data.success)===!0?(p("Success","Video link is updated."),o()):(m("Error","Update failed"),o())},I=async(i,k,r)=>{const C=ve.BASE_URL+"/api/listing/save_video_link",c={user_guid:i,business_guid:k,video_guid:r,video_url:"",video_description:"",video_title:""};s(!0),B("processing","Submitting video"),await new Promise(b=>setTimeout(b,1e3));try{const b=await fetch(C,{method:"DELETE",headers:xe,body:JSON.stringify(c)});if(b.ok)p("Success","Video deleted."),o();else{let u=b.json().then(ie=>{m("Error",`Failed: ${ie.message}`),o()})}}catch(b){console.log(b),m("Error","Update failed")}finally{s(!1)}},n=i=>{H(i)};async function te(i){const k=`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${i}&format=json`;try{const r=await fetch(k);if(!r.ok)throw new Error("Video not found");const g=await r.json();return!0}catch{return console.error("❌ Invalid or unavailable video"),!1}}const a=async i=>{B("processing","Verifying video"),await new Promise(u=>setTimeout(u,1e3));const k=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/,r=i.match(k);let g=r?r[1]:null,C=`https://img.youtube.com/vi/${g}/0.jpg`,c={videoId:g,videoUrl:i,videoThumbnail:C};if(await te(g))try{S(c),j(!0);const u=document.getElementById("yt-iframe");u.src=`https://www.youtube.com/embed/${c==null?void 0:c.videoId}`}finally{p("Success","Video link is verified"),o()}else m("Error","Video could not be loaded!"),o();await new Promise(u=>setTimeout(u,1e3)),S(c)},oe=()=>{const i=document.getElementById("videolink");a(i.value)};let ue={dialog:w,setDialog:y,handleCloseDialog:d,videoSrc:f,setVideoSrc:D,userGuid:U,setUserGuid:Y,businessGuid:P,setBusinessGuid:F,isImgSelected:W,setIsImageSelected:K,selectedFile:R,setSelectedFile:M,videoTitle:V,setVideoTitle:v,videoGuid:L,setVideoGuid:G,setVideoDescription:le,deleteVideo:I,setVideoVerified:j};return e.jsxs(ce.Provider,{value:ue,children:[w&&e.jsx("div",{className:`fixed flex w-screen h-screen z-[3000] 
                 top-0 left-0 right-0 bottom-0 bg-black/30 rounded-[8px]
                place-content-center place-items-center overflow-hidden`,children:e.jsxs("div",{className:`relative max-w-[600px] h-fit w-full bg-white mx-2
                        rounded-[40px] overflow-x-hidden overflow-y-hidden z-[3000]`,onClick:i=>{i.preventDefault()},children:[e.jsx(we,{setShow:y}),e.jsx("div",{className:"pt-12 pb-4 px-3 text-2xl font-semibold",children:"Add Video"}),e.jsxs("div",{className:"flex mb-3 flex-col mx-3 ",children:[e.jsx("div",{className:"text-[15px] pt-1 pb-1",children:"Paste a Youtube video link"}),e.jsxs("div",{className:"flex place-content-between place-items-center gap-x-4",children:[e.jsx("div",{className:"grow",children:e.jsx("input",{id:"videolink",type:"text",defaultValue:f,placeholder:"Enter Video Link",className:"w-full border-[1px] border-gray-300 bg-gray-100 px-3 py-2 outline-none rounded-lg text-xl",onKeyUp:i=>{n(i.target.value)}})}),e.jsx("div",{children:e.jsx("button",{onClick:()=>oe(),disabled:!E,className:`${E?"bg-blue-800":"bg-blue-300"} ${N&&"hidden"} text-white px-3 py-2.5 rounded-md
                                    shadow-md `,children:"Verify"})})]})]}),e.jsxs("div",{className:"relative w-full h-[300px] overflow-y-auto",children:[e.jsx("div",{className:"relative w-full h-full bg-black",children:e.jsx("div",{className:" relative w-full h-full",children:e.jsx("iframe",{id:"yt-iframe",src:f?`https://www.youtube.com/embed/${X}`:void 0,className:"absolute top-0 left-0 w-full h-full bg-black",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"})})}),e.jsxs("div",{className:"flex mb-1 flex-col mx-3 ",children:[e.jsx("div",{className:"text-[15px] pl-1 pt-3 pb-1",children:"Title"}),e.jsx("input",{id:"videotitle",defaultValue:V,type:"text",placeholder:"Enter Video Title",className:"w-full border-[1px] border-gray-300 bg-gray-100 px-3 py-4 outline-none rounded-lg text-xl"})]}),e.jsxs("div",{className:"flex mb-1 flex-col mx-3 ",children:[e.jsx("div",{className:"text-[15px] pl-1 pt-3 pb-1",children:"Description"}),e.jsx("textarea",{id:"videodescr",defaultValue:$,placeholder:"Enter video description.",className:"w-full border-[1px] border-gray-300 bg-gray-100 px-3 py-4 outline-none rounded-lg text-xl"})]}),e.jsxs("div",{className:"flex place-content-end px-6 gap-2 py-6",children:[e.jsx("button",{onMouseDown:()=>window.location.reload(),className:`bg-gray-800 text-white px-3 py-1.5 rounded-md
                                    shadow-md`,children:"Reload"}),e.jsx("button",{onMouseDown:()=>d(),className:`bg-gray-800 text-white px-3 py-1.5 rounded-md
                                    shadow-md`,children:"Close"}),e.jsx("button",{onClick:()=>x(),disabled:!N,className:`bg-blue-800 text-white px-3 py-1.5 rounded-md
                                    shadow-md `,children:N?"Submit":"Click verify above"})]})]})]})}),l]})}const we=({setShow:l})=>e.jsx("div",{className:"absolute top-8 right-6 text-3xl  rounded-xl  w-[40px] h-[40px] shadow-sm flex place-items-center place-content-center cursor-pointer bg-gray-200/70 hover:border-gray-200/50 text-gray-400 hover:text-gray-500 z-10",onClick:()=>l(!1),children:e.jsx(ae,{})});export{Ie as A,De as E,Ne as a,Ce as u};
